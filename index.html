<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<title>SCOAR Interactive Visualization</title>
		
		<!-- CSS -->
		<link rel="stylesheet" href="./css/bootstrap.min.css">
		<link rel="stylesheet" href="./css/font-awesome.min.css">
		<link href="./css/jquery.dataTables.min.css" rel="stylesheet">
		<link href="./css/application.css" rel="stylesheet">
		<link href="./css/dc.css" rel='stylesheet' />
		<link href="./css/mycss.css" rel='stylesheet' />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
	    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css' />

		<!-- JS -->
		<script src="https://code.jquery.com/jquery-1.12.3.js"></script>
        <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
		<script type="./js/contentslider.js"></script>
		<script src="//dc-js.github.io/dc.js/js/colorbrewer.js"></script>
		<script src="./js/crossfilter.js"></script>
		<script src="./js/d3.min.js"></script>
		<script src="./js/dc.js"></script>
		<script src="./js/bootstrap.min.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQ4yYk3E0pv5rwJQF1fG6qzKSiY4WVlpE"></script>
		 		<script src="http://dimplejs.org/dist/dimple.v2.2.0.min.js"></script>

		<style>
			html, body {
			height: 100%;
			width: 100%;
			margin: auto;
			padding: 0;
			}
			#map {
			height: 450px;
			width: 100%;
			margin: auto;
			}
			#bubblechartterminal {
			}
			
			#exampletable{
			margin-top: 50px;
			margin-bottom: 30px;
			}
			
			#rrow{
			width: 60%;
			}

			.legend-img{
			width:150px;
			}			

			body{
				margin-top: 50px;
				position: relative;
			}
			
			
		   
								ul.topnav {
    list-style-type: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: #252525;
	font-family: "Times New Roman", Times, serif;
}

/* Float the list items side by side */
ul.topnav li {float: left;}

/* Style the links inside the list items */
ul.topnav li a {
    display: inline-block;
    color: #f2f2f2;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    transition: 0.3s;
    font-size: 18px;
}

/* Change background color of links on hover */
ul.topnav li a:hover {background-color: #555;
text-decoration: underline;}

ul.topnav li a:active {color: #fd8d3c;}

/* Hide the list item that contains the link that should open and close the topnav on small screens */
ul.topnav li.icon {display: none;}
		</style>
		
		<script>
			var a_lat = [];
			var a_long = [];
			var countries = [];
			var study_id = [];
			var url = [];
			var keep =[];
			var urlLinks=[];
			var link=[];
			var city=[];
			var region=[];

			d3.csv("static/Book3.csv", function(stokedatanew) {
				for (i in stokedatanew){
					//if (studyID.includes(stokedatanew[i].study_id) == false){
						countries.push(stokedatanew[i].country)
						city.push(stokedatanew[i].city)
						region.push(stokedatanew[i].region)
						a_lat.push(parseFloat(stokedatanew[i].lat2))
						a_long.push(parseFloat(stokedatanew[i].long2))
						study_id.push(stokedatanew[i].study_id_all)
						urlLinks.push(stokedatanew[i].url)
						link.push(stokedatanew[i].link)
					//};
				};

				
				fLen=a_lat.length;
				console.log(fLen);
				var bangalore =new Array(fLen);
				
				function initialize() {
					for (i = 0; i < fLen; i++) {
						bangalore[i] = new google.maps.LatLng(a_lat[i],	a_long[i]);
					}
					
					bangalore[fLen] = new google.maps.LatLng(28.0339, 1.6596);
					var map = new google.maps.Map(document.getElementById('map'), {
						zoom: 2,
						center: bangalore[fLen]
					});
				
					for (i = 0; i < fLen; i++) {
						// Add a marker at the center of the map.
						addMarker(bangalore[i], map);
					};
					// Adds a marker to the map.
					function addMarker(location, map) {

						var image = {
					        url: './static/paper.png', // image is 512 x 512
					        scaledSize : new google.maps.Size(30, 30),
					    };
						var icons = {
				          paper: {
				            icon: image
				          }
				        };
						// Add the marker at the clicked location, and add the next-available label
						// from the array of alphabetical characters.
						var marker = new google.maps.Marker({
							position: location,
							//label: labels[labelIndex++ % labels.length],
							map: map,
							icon: icons['paper'].icon
							//title: tag[tagIndex++ % tag.length]
						});

						var infowindow = new google.maps.InfoWindow({
						content: "City: "+city[i]+", Region: "+region[i]+", "+countries[i] +"<br>"+ link[i]
					});
						
						marker.addListener('click', function() {
							infowindow.open(map, marker);
						});
						
					}
				}
				google.maps.event.addDomListener(window, 'load', initialize);
			});
		</script>
	</head>
	<body data-spy="scroll" data-target=".navbar" data-offset="50">
<nav class="navbar navbar-inverse navbar-fixed-top">
 <div class="container-fluid">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
      </button>
      <p class="navbar-brand" style="color:#fd8d3c;"><b>SCOAR|</b> Interactive Visualization in Stroke Rehabilitation</p>
    </div>
    <div>
       <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="topnav" id="myTopnav">
      		<li><a  style="color: #fecc5c;" href="#">Overview</a></li>
	        <li><a   href="./Clinical Trials.html">Clinical Trials</a></li>
			<li><a   href="./Our Team.php">Our Team</a></li>
			<li class="icon">
				<a href="javascript:void(0);" onclick="myFunction()">&#9776;</a>
			</li>
    </ul>
      </div>
    </div>
  </div>
</nav>    




<!--
	<div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#">WebSiteName</a>
    </div>
		<nav class="navbar navbar-inverse navbar-fixed-top">
		  <ul class="nav navbar-nav">
		    <li><a href="#World Map">World Map <span class="sr-only">(current)</span></a></li>
		        <li><a href="#Bar Chart">Bar Chart</a></li>
		        <li><a href="#Terminal Hedge">Terminal Hedge</a></li>
		        <li><a href="#Motivation">Motivation</a></li>
		        <li><a href="#Dataset">Dataset</a></li>
		        <li><a href="#Process">Process</a></li>
		        <li><a href="#Questions">Questions</a></li>
		        <li><a href="#Video">Video</a></li>
		        <li><a href="#Team">Team</a></li>
		        <li><a href="#Copyright">Copyright</a></li>

		</nav>

		


-->


<section id="World Map">  
	<div class="row  vbar1">
		<div class = "col-lg-4 col-md-4 col-sm-6 col-xs-12">
			<h3 style="color:#0047b3;", align="center">Overview of Stroke Rehabilitation Studies Around the World</h3>
			<p align="justify">The <strong>Centralized Open-Access Rehabilitation Database for Stroke (SCOAR)</strong> is a tool that 
            stroke therapy researchers can use to better understand the relationships among variables, efficiently share data, generate 
            hypotheses, and streamline clinical trial design. The purpose of this website is to bring people as close to the data as 
            possible through effective and efficient visualizations. For more information about how to use the website, please see the 
            video below. For a description of variable names, see the "Database" section on <a href="./page2.html" target="_blank">Clinical Trials</a>.</p>
			<p align="justify"> The Google map shows which countries randomized clinical trials (RCTs) in the SCOAR database come from. 
            Click on the paper symbol to see more information about that RCT. (Clicking on the author name will then transfer you to the URL of the 
            related paper.) In order to zoom in/zoom out the map use +/- on the right bottom corner of the map.</p>
		</div>
		<div class = "col-lg-8 col-md-8 col-sm-6 col-xs-12">
			<div id="map"></div>
		</div>
	</div>
</section>

<section id="Bar Chart">  
	<div class="row  vbar2">
		<div class = "col-lg-7 col-md-7 col-sm-6 col-xs-12">
				<div id = "rrow">
						<div id="terminaleffectssizebubble" class="bubblechart">
							<a class="reset" href="javascript:terminaleffectssizebubble.filterAll();dc.redrawAll();" style="display: none;"></a>
						</div>
				</div>
		</div>

		<div class = "col-lg-5 col-md-5 col-sm-6 col-xs-12">
			<div id="bubblechartterminal" class="collapse in">
				<h3 style="color:#0047b3;", align="center">Number of groups of studies in different continents</h3>
			<p align="justify">The number of RCTs per continent in the SCOAR database is shown in this bar chart.</p> 
			<p align="justify"> Trials in the SCOAR database came from 114 cities/states in 28 different countries. From this wide range of trial 
            locations, SCOAR represents rehabilitation trials across the globe. Presenting the data geographically, we can see there are relatively 
            few trials for regions such as South America, Africa, central Asia, and eastern Europe.</p>
			</div>
		</div>
	</div>	
</section>  

<section id="Motivation">
	<div class="row  vbar1">
		<div class = "col-lg-5 col-md-5 col-sm-12 col-xs-12">
                <h3 style="color:#0047b3;">Motivation</h3>
		<p align="justify">The evidence-base in rehabilitation is always expanding. Researchers, clinicians, and other stakeholders need effective 
        tools for collecting, managing, analyzing, and visualizing data, but currently RCTs are published in a wide range of formats, across many 
        different journals, and often unavailable (due to paywalls). As such, the goal of SCOAR is to improve methods for searching the literature, 
        conducting power analyses, and place individual studies in their broader context. As SCOAR develops, we hope these data will help improve 
        experiments in rehabilitation, and (ultimately) improve the quality of life for individuals with disabilities. </p> 
		<p align="justify">Keith Lohse and his colleagues developed SCOAR to ease data integration across studies and to increase the visibility 
        of a comprehensive body of evidence. The initial SCOAR database was based on a systematic review and screening that left 215 RCTs in the 
        database. From these RCTs there are 489 independent group representing 12,847 patients. SCOAR is a living database, however, and data are 
        continuous extracted from publications and uploaded into the database. </p>
		<p align="justify">Since, there are large amounts of data with very different attributes in SCOAR, this website is interactive, specifically 
        to allow researchers to explore various relationships among variables. Our goal is to <strong>allow researchers to efficiently ask their own 
        research questions, generate hypotheses, see the relationships among the reported variables across hundreds of trials. </p>
		<p align="justify"></strong> As new data 
        are published, we also hope that researchers will use SCOAR as a platform to share their summary data with other researchers in a structured 
        format. We should also point out that the <a href="https://github.com/keithlohse/SCOAR/" target="_blank">raw SCOAR data</a> are availble to researchers 
                at any time</a>.
		</div>
		<div class = "col-lg-6 col-md-offset-1 col-md-6 col-sm-12 col-xs-12">
                <h3 style="color:#0047b3;">Process</h3>
                 <p align="justify">For this website, we have arranged the 
                visualizations around <strong>three main research questions.</strong> Users can interact with these visualizations to modify them, 
                filter the data, and link back to original studies to explore data points that are new or surprising! We want powerful visualizations 
                that will get users as closer to the data as possible. (Please refer to <a href="./Clinical Trials.html" target = "_blank">Clinical Trials</a> to explore 
                the answer for these research questions) </p>
				
				
				
				<div class="panel panel-danger">
				  <div class="panel-heading">
				    <h3 class="panel-title"><strong>1: Is there substantial bias? </strong></h3>
				  </div>
				  <div class="panel-body">
				    <ul style="list-style-type:none">
						<p align="justify">By plotting summary statistics from rehabilitation RCTs, which can be further filtered by study characteristics, 
                        it is easy to look at publication bias across trials in stroke rehabilitation (or in sub-areas when filters are applied).</p>
					
					</ul>
				  </div>
				  <div class="panel-heading">
				    <h3 class="panel-title"><strong>2. What are the common experimental parameters?</strong> </h3>
				  </div>
				  <div class="panel-body">
				    <ul style="list-style-type:none">
						<p align="justify">Cross-indexing common study parameters with experimental outcomes allows researchers to quickly and easily visualize 
                        relationships in the field. These visualizations are useful for summarizing past research but also inform future research. For instance, 
                        users could filter SCOAR data to see the range of effect sizes for different amounts of therapy at different times post-stroke. Having 
                        these experimental parameters available in a few clicks means that researchers can engage in more evidence-based plannng of their 
                        experiments, do more case-specific power analyses, and in general see what the "history" of the field has to say about a question (rather 
                        than just a few recent and/or seminal studies).</p>
					
					</ul>
				  </div>
				  <div class="panel-heading">
				    <h3 class="panel-title"><strong>3. What treatments are more effective and for whom?</strong></h3>
				  </div>
				  <div class="panel-body">
				    <ul style="list-style-type:none">
						<p align="justify">As above, cross-indexing common study parameters with outcome measures makes it easy to see important relationships in 
                        stroke rehabilitation. Using SCOAR, users can plot dose-response curves for therapy overall (using all outcome measures), for specific 
                        outcomes (e.g., upper extremity versus lower extremity), or for specific groups of participants (e.g., younger to older, severely impaired 
                        to minimally impaired).</p>
					
					</ul>
				  </div>
				</div>
				
				
				
				
			</div>
		</div>
</section>
			
<section id="Video">  
	<div class="row  vbar2">
		<div class = "col-md-6 col-sm-6 col-xs-12">

		</div>

		<div class = "col-md-offset-2 col-md-4  col-sm-6 col-xs-12">
			<div id="bubblechartterminal" class="collapse in">
				<h3 style="color:#0047b3">How to use the website: Video</h3> 
                <p align="justify">In this video, Dr. Lohse talks about how to use each page of the SCOAR website. He introduces the SCOAR database, our research 
                questions, and tips for efficiently using this website to interact with our visualizations.</p>
			</div>
		</div>
	</div>	
</section>

	</body>


	<script>
	
		d3.csv('./static/Book3.csv', function(Book2) {
			Book2.forEach(function(d) {
				d.group = d["group"];
				d.group_id = d["index"];
				d.country = d["country"];
				d.continent = d["continent"];
			});
			
			var terminaleffectssizebubble = dc.barChart('#terminaleffectssizebubble');
			var numberFormat1 = d3.format(".3f");
			var numberFormat2 = d3.format(",.0f");
			// cross filter object
			var crossDataforviz = crossfilter(Book2);
			var continentDim = crossDataforviz.dimension(function (d) {return d.continent;});
			var continentGroup = continentDim.group().reduce(
			function (p, v) {
				++p.count;
			return p;},
			function (p, v) {
				--p.count;
				return p;
			},
			function () {
			return {count: 0}});					
			terminaleffectssizebubble
			.width(550)
			.height(300)
			.margins({top: 20, left: 40, right: 20, bottom: 55})
			
			.x(d3.scale.ordinal().domain(["Asia","Europe"," Africa","North America","South America"," Australia"]))
			.xUnits(dc.units.ordinal)
			.brushOn(false)
			.yAxisLabel("Number of studies")
			.dimension(continentDim)
			.group(continentGroup)
			
			.valueAccessor(function (d) {return d.value.count;})
			.label(function (d) {
			return d.key;})
			.renderHorizontalGridLines(true)
			
			.title(function (d) {
				return d.key + "\n" + "Number of Groups in database:" + "\n" + numberFormat2(d.value.count);
			})
			.elasticX(true);
			dc.renderAll();
			
			function AddXAxis(chartToUpdate, displayText)
			{
				chartToUpdate.svg()
				.append("text")
				.attr("class", "x-axis-label")
				.attr("text-anchor", "middle")
				.attr("x", chartToUpdate.width()/2)
				.attr("y", chartToUpdate.height()-3.5)
				.attr("margin-top", "200px")
				.text(displayText);
			}
		});	



	</script>
	
	
	<!--
	Substantial bias
	-->
	

	<script src="./js/data.js"></script>

	<script>
		timeNum=1;
		filename1='./static/dataterm.csv';
		function drop1(){
				$('#urlList').html('');
			d3.csv(filename1, function(dataterm) {
			dataterm.forEach(function(d) {
				d.missingdata = d["MissingData"];
			    d.group = d["group"];
				d.days_cat = d["days_cat"];
				d.age_category = d["age_category"];
				d.age_base = parseFloat(d["age_base"]);
				d.base_n = parseFloat(d["base_n"]);
				d.url=d["url"];
				
				if(timeNum==1)
					d.time_50 = parseFloat(d["time_50"]);
				else if(timeNum==2)
					d.time_50 = parseFloat(d["time_MAX"]);
				else
					d.time_50 = parseFloat(d["time_MIN"]);
				if (filename1=='./static/dataterm.csv')
					d.term_g = parseFloat(d["term_g"])
				else d.term_g = parseFloat(d["fu_g"]);

				d.term_g = parseFloat(d["term_g"]);
				d.termvginv = parseFloat(d["termvginv"]);
				d.outcomenamecat = d["outcomenamecat"];
				d.group_id = d["group_id"];
			  });
			  
			
			var stackgroupbar = dc.rowChart('#stackgroupbar');
			var stackdaysbar = dc.barChart('#stackdaysbar');
			var stackagebar = dc.barChart('#stackagebar');
			var terminaleffectssizebubble = dc.bubbleChart('#terminaleffectssizebubble2');
			var groupbubble = dc.bubbleChart('#groupbubble');
			var numberFormat1 = d3.format(".3f");
			var numberFormat2 = d3.format(",.0f");
								
			// cross filter object
			var crossDataforviz = crossfilter(dataterm);
			var groupDim = crossDataforviz.dimension(function (d) {return d.group;});
			var days_catDim = crossDataforviz.dimension(function (d) {return d.days_cat;});
			var age_baseDim = crossDataforviz.dimension(function (d) {return d.age_base;});
			var group_idDim = crossDataforviz.dimension(function (d) {return d.group_id;});
			var minusage_base = age_baseDim.bottom(1)[0].age_base;
			var maxusage_base= age_baseDim.top(1)[0].age_base;
			var groupGroup = groupDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
														
			var days_catGroup = days_catDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
														
			var age_baseGroup = age_baseDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
													
			var group_idGroup = group_idDim.group().reduce(
														function (p, v) {
														++p.count;
														p.time_50Sum += v.time_50;
														p.url = v.url;
														p.avgtime_50 = p.count ? p.time_50Sum / p.count : 0;
														p.term_gSum += v.term_g;
														p.avgterm_g = p.count ? p.term_gSum / p.count : 0;
														p.termvginvSum += v.termvginv;
														p.avgtermvginv = p.count ? p.termvginvSum / p.count : 0;
														p.outcomenamecatList.push(v.outcomenamecat);
														return p;},
														function (p, v) {
														--p.count;
														p.time_50Sum -= v.time_50;
														p.avgtime_50 = p.count ? p.time_50Sum / p.count : 0;
														p.term_gSum -= v.term_g;
														p.avgterm_g = p.count ? p.term_gSum / p.count : 0;
														p.termvginvSum -= v.termvginv;
														p.avgtermvginv = p.count ? p.termvginvSum / p.count : 0;
														p.outcomenamecatList.pop(v.outcomenamecat);
														return p;
														},
														function () {
														return {count: 0,time_50Sum: 0,
																avgtime_50: 0, 
																term_gSum: 0, 
																avgterm_g: 0,
																termvginvSum: 0,
																avgtermvginv: 0,
																outcomenamecatList:[]}});

														
			terminaleffectssizebubble 
			.width(600)
			.height(500)
			.margins({top: 15, left: 40, right: 15, bottom: 30})
			.dimension(group_idDim)
			.group(group_idGroup)
			.colors(d3.scale.ordinal().range([ '#7fc97f', '#beaed4', '#fdc086','#ffff99', '#386cb0','#f0027f','#bf5b17'])
			.domain(['other','fma','balance','speed','capacity','wmft','arat']))
			.colorAccessor(function (d) {return d.value.outcomenamecatList[0];})
			.keyAccessor(function (p) {
					return p.value.avgtime_50;
				})
			.valueAccessor(function (p) {return p.value.avgterm_g;})
			.radiusValueAccessor(function (p) {if(p.value.avgtime_50==0 || p.value.term_g==0) {return 0;} else {return (p.value.avgtermvginv)/100;}})
			.x(d3.scale.linear().domain([0,250]))
			.y(d3.scale.linear().domain([0,2.5]))
			.r(d3.scale.linear())
			.elasticY(false)
			.elasticX(false)
			.yAxisPadding(1)
			.xAxisPadding(10)
			.maxBubbleRelativeSize(0.02)
			.renderHorizontalGridLines(true)
			.renderVerticalGridLines(true)
			.xAxisLabel(function () {
				if(timeNum==1)
					return 'Time 50 (Hours)';
				else if(timeNum==2)
					return 'Time MAX (Hours)';
				else
					return 'Time MIN (Hours)';
				})
			.yAxisLabel(function () {
				if (filename1=='./static/dataterm.csv')
					return 'Term G';
				else return 'Follow up g';
			})
			.renderTitle(true)
			.renderLabel(false)
			.title(function (p){
				
				theyaxis='Follow up g: '
				if(timeNum==1)
					thetime='Time 50 (Hours): ';
				else if(timeNum==2)
					thetime='Time MAX (Hours): ';
				else
					thetime='Time MIN (Hours): ';
				

				if (filename1=='./static/dataterm.csv')
					theyaxis='Term G: ';

				return ['Group id: ' + p.key,
				thetime + p.value.avgtime_50,
				theyaxis + Math.round(p.value.avgterm_g * 1000) / 1000 ,
				'Term VG Inverse: ' + Math.round(p.value.avgtermvginv * 1000) / 1000 ,
				'Outcome Name: ' + p.value.outcomenamecatList[0], p.value.url].join('\n');
				})

			terminaleffectssizebubble.filterHandler(function(dim, filters) {
				urltxt="<span style='font-weight:bold'>Click to open the papers: </span>"
				for (var i =0 ; i < filters.length ; i++)
					dataterm.forEach(function(d) {
						if(d.group_id==filters[i])
							urltxt+="<kbd><a class='paperItem' href='"+d.url+"'  target='_blank'>"+d.id+"</a></kbd>   ";
				})
				$('#urlList').html(urltxt);			
			});

/*
			var node11 = legend.selectAll(".legendItem")
          .data(clusterData)
          .enter().append("g")
          .attr("class", "legendItem")
          .on('click', function(d){clusterClick(d.cluster-1, this)});
*/
				//d3.selectAll("circle").on("contextmenu",
				//	function(){d3.event.preventDefault(); console.log("http://google.com");});
		//mysvg=d3.select(".node").data(dataterm).enter();
		//console.log(mysvg);

//mysvg.on('click', function() {console.log(1)});

				terminaleffectssizebubble.yAxis().tickFormat(d3.format(",.2f")).ticks(10)
				terminaleffectssizebubble.xAxis().tickFormat(d3.format(",.2f")).ticks(10)

              
			groupbubble.width(990)
                    .height(200)
                    .margins({top: 10, right: 50, bottom: 30, left: 60})
                    .dimension(group_idDim)
                    .group(group_idGroup)
                    .colors(d3.scale.category10())
                    .keyAccessor(function (p) {
                        return p.value.avgtime_50;
                    })
                    .valueAccessor(function (p) {
                        return p.value.avgterm_g;
                    })
                    .radiusValueAccessor(function (p) {
                        return p.value.avgtime_50;
                    })
                    .x(d3.scale.linear().domain([0, 5000]))
                    .r(d3.scale.linear().domain([0, 4000]))
                    .minRadiusWithLabel(15)
                    .elasticY(true)
                    .yAxisPadding(100)
                    .elasticX(true)
                    .xAxisPadding(200)
                    .maxBubbleRelativeSize(0.07)
                    .renderHorizontalGridLines(true)
                    .renderVerticalGridLines(true)
                    .renderLabel(true)
                    .renderTitle(true)
                    .title(function (p) {
                        return p.key
                                + "\n"
                                + "Amount Raised: " + numberFormat(p.value.avgtime_50) + "M\n"
                                + "Number of avgterm_g: " + numberFormat(p.value.avgterm_g);
                    });
            groupbubble.yAxis().tickFormat(function (s) {
                return s + " avgterm_g";
            });
            groupbubble.xAxis().tickFormat(function (s) {
                return s + "M";
            });



												stackgroupbar
											.width(350)
											.height(250)
											.margins({top: 20, left: 40, right: 20, bottom: 40})
											.group(groupGroup)
											.dimension(groupDim)
											.colors(d3.scale.ordinal().range([ '#fa9fb5', '#c51b8a'])
											.domain(["Ctrl", "Exp"]))
											.valueAccessor(function (d) {return d.value.count;})
											.label(function (d) {
												return d.key;})
												
											.title(function (d) {
												return d.key + "\n" + "Number of Studies:" + "\n" + numberFormat2(d.value.count);
											})
											.elasticX(true)
											.xAxis().ticks(5);
														 
														stackagebar
												        .width(350)
														.height(250)
														.margins({top: 20, left: 40, right: 20, bottom: 40})
														.dimension(age_baseDim)
														.group(age_baseGroup)
														.valueAccessor(function (d) {return d.value.count;})
														.title(function (d) {
															return d.key + "\n" + "Number of groups in database:" + "\n" + numberFormat2(d.value.count);
														})
														.transitionDuration(500)
														.centerBar(true)	
														.x(d3.scale.linear().domain([30,90]))
														.yAxisLabel("Number of Groups")
														.xAxisLabel("Average Age")
														.elasticX(false)
														.elasticY(true)
														.yAxis().ticks(5);
														
													stackagebar.xAxis().tickFormat(d3.format("02d"))
													stackagebar.yAxis().tickFormat(d3.format("d"))
													stackagebar.xUnits(function(){return 50;});	

												stackdaysbar
												
													.width(350)
													.height(250)
													.margins({top: 20, left: 40, right: 20, bottom: 40})
								
													.x(d3.scale.ordinal().domain(["<1year", "<90days", ">1year", "Not Available"]))
													.xUnits(dc.units.ordinal)
													.brushOn(false)
													.yAxisLabel("Number of Groups")
													.xAxisLabel("Days pre Therapy")
													.dimension(days_catDim)
													.group(days_catGroup)
													
								
													.valueAccessor(function (d) {return d.value.count;})
													.label(function (d) {
															return d.key;})
													.renderHorizontalGridLines(true)
								                    .colors(d3.scale.ordinal().range([ '#009999', '#009999', '#009999', '#009999'])
														.domain(["<1year", "<90days", ">1year", "Not Available"]))
													 
													.title(function (d) {
														return d.key + "\n" + "Number of Groups in database:" + "\n" + numberFormat2(d.value.count);
													})
													.elasticX(true);
													dc.renderAll();

			function AddXAxis(chartToUpdate, displayText) {
			    chartToUpdate.svg()
			                .append("text")
			                .attr("class", "x-axis-label")
			                .attr("text-anchor", "middle")
			                .attr("x", chartToUpdate.width()/2)
			                .attr("y", chartToUpdate.height()-3.5)
							.attr("margin-top", "200px")
			                .text(displayText);
			}
			});
	}

	drop1('./static/folloda.csv');
	</script>  


<script>
		timeNum=1;
		filename1='./static/dataterm.csv';
		function drop2(){
				$('#urlList').html('');
			d3.csv(filename1, function(dataterm) {
			dataterm.forEach(function(d) {
				d.missingdata = d["MissingData"];
			    d.group = d["group"];
				d.days_cat = d["days_cat"];
				d.age_category = d["age_category"];
				d.age_base = parseFloat(d["age_base"]);
				d.base_n = parseFloat(d["base_n"]);
				d.url=d["url"];
				
				if(timeNum==1)
					d.time_50 = parseFloat(d["time_50"]);
				else if(timeNum==2)
					d.time_50 = parseFloat(d["time_MAX"]);
				else
					d.time_50 = parseFloat(d["time_MIN"]);
				if (filename1=='./static/dataterm.csv')
					d.term_g = parseFloat(d["term_g"])
				else d.term_g = parseFloat(d["fu_g"]);

				d.term_g = parseFloat(d["term_g"]);
				d.termvginv = parseFloat(d["termvginv"]);
				d.outcomenamecat = d["outcomenamecat"];
				d.group_id = d["group_id"];
			  });
			  
			
			var stackgroupbar = dc.rowChart('#stackgroupbar2');
			var stackdaysbar = dc.barChart('#stackdaysbar2');
			var stackagebar = dc.barChart('#stackagebar2');
			var terminaleffectssizebubble = dc.bubbleChart('#terminaleffectssizebubble2');
			var groupbubble = dc.bubbleChart('#groupbubble');
			var numberFormat1 = d3.format(".3f");
			var numberFormat2 = d3.format(",.0f");
								
			// cross filter object
			var crossDataforviz = crossfilter(dataterm);
			var groupDim = crossDataforviz.dimension(function (d) {return d.group;});
			var days_catDim = crossDataforviz.dimension(function (d) {return d.days_cat;});
			var age_baseDim = crossDataforviz.dimension(function (d) {return d.age_base;});
			var group_idDim = crossDataforviz.dimension(function (d) {return d.group_id;});
			var minusage_base = age_baseDim.bottom(1)[0].age_base;
			var maxusage_base= age_baseDim.top(1)[0].age_base;
			var groupGroup = groupDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
														
			var days_catGroup = days_catDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
														
			var age_baseGroup = age_baseDim.group().reduce(
														function (p, v) {
														++p.count;
														return p;},
														function (p, v) {
														--p.count;
														return p;
														},
														function () {
														return {count: 0}});
													
			var group_idGroup = group_idDim.group().reduce(
														function (p, v) {
														++p.count;
														p.time_50Sum += v.time_50;
														p.url = v.url;
														p.avgtime_50 = p.count ? p.time_50Sum / p.count : 0;
														p.term_gSum += v.term_g;
														p.avgterm_g = p.count ? p.term_gSum / p.count : 0;
														p.termvginvSum += v.termvginv;
														p.avgtermvginv = p.count ? p.termvginvSum / p.count : 0;
														p.outcomenamecatList.push(v.outcomenamecat);
														return p;},
														function (p, v) {
														--p.count;
														p.time_50Sum -= v.time_50;
														p.avgtime_50 = p.count ? p.time_50Sum / p.count : 0;
														p.term_gSum -= v.term_g;
														p.avgterm_g = p.count ? p.term_gSum / p.count : 0;
														p.termvginvSum -= v.termvginv;
														p.avgtermvginv = p.count ? p.termvginvSum / p.count : 0;
														p.outcomenamecatList.pop(v.outcomenamecat);
														return p;
														},
														function () {
														return {count: 0,time_50Sum: 0,
																avgtime_50: 0, 
																term_gSum: 0, 
																avgterm_g: 0,
																termvginvSum: 0,
																avgtermvginv: 0,
																outcomenamecatList:[]}});

														
			terminaleffectssizebubble 
			.width(600)
			.height(500)
			.margins({top: 15, left: 40, right: 15, bottom: 30})
			.dimension(group_idDim)
			.group(group_idGroup)
			.colors(d3.scale.ordinal().range([ '#7fc97f', '#beaed4', '#fdc086','#ffff99', '#386cb0','#f0027f','#bf5b17'])
			.domain(['other','fma','balance','speed','capacity','wmft','arat']))
			.colorAccessor(function (d) {return d.value.outcomenamecatList[0];})
			.keyAccessor(function (p) {
					return p.value.avgtime_50;
				})
			.valueAccessor(function (p) {return p.value.avgterm_g;})
			.radiusValueAccessor(function (p) {if(p.value.avgtime_50==0 || p.value.term_g==0) {return 0;} else {return (p.value.avgtermvginv)/100;}})
			.x(d3.scale.linear().domain([0,250]))
			.y(d3.scale.linear().domain([0,2.5]))
			.r(d3.scale.linear())
			.elasticY(false)
			.elasticX(false)
			.yAxisPadding(1)
			.xAxisPadding(10)
			.maxBubbleRelativeSize(0.02)
			.renderHorizontalGridLines(true)
			.renderVerticalGridLines(true)
			.xAxisLabel(function () {
				if(timeNum==1)
					return 'Time 50 (Hours)';
				else if(timeNum==2)
					return 'Time MAX (Hours)';
				else
					return 'Time MIN (Hours)';
				})
			.yAxisLabel(function () {
				if (filename1=='./static/dataterm.csv')
					return 'Term G';
				else return 'Follow up g';
			})
			.renderTitle(true)
			.renderLabel(false)
			.title(function (p){
				
				theyaxis='Follow up g: '
				if(timeNum==1)
					thetime='Time 50 (Hours): ';
				else if(timeNum==2)
					thetime='Time MAX (Hours): ';
				else
					thetime='Time MIN (Hours): ';
				

				if (filename1=='./static/dataterm.csv')
					theyaxis='Term G: ';

				return ['Group id: ' + p.key,
				thetime + p.value.avgtime_50,
				theyaxis + Math.round(p.value.avgterm_g * 1000) / 1000 ,
				'Term VG Inverse: ' + Math.round(p.value.avgtermvginv * 1000) / 1000 ,
				'Outcome Name: ' + p.value.outcomenamecatList[0], p.value.url].join('\n');
				})

			terminaleffectssizebubble.filterHandler(function(dim, filters) {
				urltxt="<span style='font-weight:bold'>Click to open the papers: </span>"
				for (var i =0 ; i < filters.length ; i++)
					dataterm.forEach(function(d) {
						if(d.group_id==filters[i])
							urltxt+="<kbd><a class='paperItem' href='"+d.url+"'  target='_blank'>"+d.id+"</a></kbd>   ";
				})
				$('#urlList').html(urltxt);			
			});

/*
			var node11 = legend.selectAll(".legendItem")
          .data(clusterData)
          .enter().append("g")
          .attr("class", "legendItem")
          .on('click', function(d){clusterClick(d.cluster-1, this)});
*/
				//d3.selectAll("circle").on("contextmenu",
				//	function(){d3.event.preventDefault(); console.log("http://google.com");});
		//mysvg=d3.select(".node").data(dataterm).enter();
		//console.log(mysvg);

//mysvg.on('click', function() {console.log(1)});

				terminaleffectssizebubble.yAxis().tickFormat(d3.format(",.2f")).ticks(10)
				terminaleffectssizebubble.xAxis().tickFormat(d3.format(",.2f")).ticks(10)

              
			groupbubble.width(990)
                    .height(200)
                    .margins({top: 10, right: 50, bottom: 30, left: 60})
                    .dimension(group_idDim)
                    .group(group_idGroup)
                    .colors(d3.scale.category10())
                    .keyAccessor(function (p) {
                        return p.value.avgtime_50;
                    })
                    .valueAccessor(function (p) {
                        return p.value.avgterm_g;
                    })
                    .radiusValueAccessor(function (p) {
                        return p.value.avgtime_50;
                    })
                    .x(d3.scale.linear().domain([0, 5000]))
                    .r(d3.scale.linear().domain([0, 4000]))
                    .minRadiusWithLabel(15)
                    .elasticY(true)
                    .yAxisPadding(100)
                    .elasticX(true)
                    .xAxisPadding(200)
                    .maxBubbleRelativeSize(0.07)
                    .renderHorizontalGridLines(true)
                    .renderVerticalGridLines(true)
                    .renderLabel(true)
                    .renderTitle(true)
                    .title(function (p) {
                        return p.key
                                + "\n"
                                + "Amount Raised: " + numberFormat(p.value.avgtime_50) + "M\n"
                                + "Number of avgterm_g: " + numberFormat(p.value.avgterm_g);
                    });
            groupbubble.yAxis().tickFormat(function (s) {
                return s + " avgterm_g";
            });
            groupbubble.xAxis().tickFormat(function (s) {
                return s + "M";
            });



												stackgroupbar
											.width(350)
											.height(250)
											.margins({top: 20, left: 40, right: 20, bottom: 40})
											.group(groupGroup)
											.dimension(groupDim)
											.colors(d3.scale.ordinal().range([ '#fa9fb5', '#c51b8a'])
											.domain(["Ctrl", "Exp"]))
											.valueAccessor(function (d) {return d.value.count;})
											.label(function (d) {
												return d.key;})
												
											.title(function (d) {
												return d.key + "\n" + "Number of Studies:" + "\n" + numberFormat2(d.value.count);
											})
											.elasticX(true)
											.xAxis().ticks(5);
														 
														stackagebar
												        .width(350)
														.height(250)
														.margins({top: 20, left: 40, right: 20, bottom: 40})
														.dimension(age_baseDim)
														.group(age_baseGroup)
														.valueAccessor(function (d) {return d.value.count;})
														.title(function (d) {
															return d.key + "\n" + "Number of groups in database:" + "\n" + numberFormat2(d.value.count);
														})
														.transitionDuration(500)
														.centerBar(true)	
														.x(d3.scale.linear().domain([30,90]))
														.yAxisLabel("Number of Groups")
														.xAxisLabel("Average Age")
														.elasticX(false)
														.elasticY(true)
														.yAxis().ticks(5);
														
													stackagebar.xAxis().tickFormat(d3.format("02d"))
													stackagebar.yAxis().tickFormat(d3.format("d"))
													stackagebar.xUnits(function(){return 50;});	

												stackdaysbar
												
													.width(350)
													.height(250)
													.margins({top: 20, left: 40, right: 20, bottom: 40})
								
													.x(d3.scale.ordinal().domain(["<1year", "<90days", ">1year", "Not Available"]))
													.xUnits(dc.units.ordinal)
													.brushOn(false)
													.yAxisLabel("Number of Groups")
													.xAxisLabel("Days pre Therapy")
													.dimension(days_catDim)
													.group(days_catGroup)
													
								
													.valueAccessor(function (d) {return d.value.count;})
													.label(function (d) {
															return d.key;})
													.renderHorizontalGridLines(true)
								                    .colors(d3.scale.ordinal().range([ '#009999', '#009999', '#009999', '#009999'])
														.domain(["<1year", "<90days", ">1year", "Not Available"]))
													 
													.title(function (d) {
														return d.key + "\n" + "Number of Groups in database:" + "\n" + numberFormat2(d.value.count);
													})
													.elasticX(true);
													dc.renderAll();

			function AddXAxis(chartToUpdate, displayText) {
			    chartToUpdate.svg()
			                .append("text")
			                .attr("class", "x-axis-label")
			                .attr("text-anchor", "middle")
			                .attr("x", chartToUpdate.width()/2)
			                .attr("y", chartToUpdate.height()-3.5)
							.attr("margin-top", "200px")
			                .text(displayText);
			}
			});
	}

	drop2('./static/folloda.csv');
	</script>  

	<script type="text/javascript">
    var svg = dimple.newSvg("#chartContainer", 630, 600);
      d3.csv("./static/dataterminal.csv", function (data) {
      	var crossDataforviz = crossfilter(data);
        // Latest period only
        ////dimple.filterData(data, "Date", "01/12/2012");
        // Create the chart
        var myChart = new dimple.chart(svg, data);
        //data = dimple.filterData(data, "time_501", 0);
        myChart.setBounds(60, 30, 450, 450)

        // Create a standard bubble of SKUs by Price and Sales Value
        // We are coloring by Owner as that will be the key in the legend
        myChart.addMeasureAxis("x", "time_50 (Hours)");
        myChart.addMeasureAxis("y", "term_g");
        myChart.addSeries(["index","outcomenamecat"], dimple.plot.bubble);
        var myLegend = myChart.addLegend(550, 100, 60, 300, "Right");
        myChart.draw();
        
        // This is a critical step.  By doing this we orphan the legend. This
        // means it will not respond to graph updates.  Without this the legend
        // will redraw when the chart refreshes removing the unchecked item and
        // also dropping the events we define below.
        myChart.legends = [];

        // This block simply adds the legend title. I put it into a d3 data
        // object to split it onto 2 lines.  This technique works with any
        // number of lines, it isn't dimple specific.
        svg.selectAll("title_text")
          .data([" "])
          .enter()
          .append("text")
            .attr("x", 530)
            .attr("y", function (d, i) { return 90 + i * 14; })
            .style("font-family", "sans-serif")
            .style("font-size", "20px")
            .style("color", "Black")
            .text(function (d) { return d; });


svg.selectAll(".dimple-title")
            .style("font-size", "20px");


        // Get a unique list of Owner values to use when filtering
        var filterValues = dimple.getUniqueValues(data, "outcomenamecat");
        // Get all the rectangles from our now orphaned legend
        myLegend.shapes.selectAll("rect")
          // Add a click event to each rectangle
          .on("click", function (e) {
            // This indicates whether the item is already visible or not
            var hide = false;
            var newFilters = [];
            // If the filters contain the clicked shape hide it
            filterValues.forEach(function (f) {
              if (f === e.aggField.slice(-1)[0]) {
                hide = true;
              } else {
                newFilters.push(f);
              }
            });

            // Hide the shape or show it
            if (hide) {
              d3.select(this).style("opacity", 0.2);
            } else {
              newFilters.push(e.aggField.slice(-1)[0]);
              d3.select(this).style("opacity", 0.7);
            }
            // Update the filters
            filterValues = newFilters;
            // Filter the data
            myChart.data = dimple.filterData(data, "outcomenamecat", filterValues);
            // Passing a duration parameter makes the chart animate. Without
            // it there is no transition
            myChart.draw(800);
          });
      });
  </script>







<script>  
	$('body').scrollspy({ target: '#navbar-example' })
	$('[data-spy="scroll"]').each(function () {
	  var $spy = $(this).scrollspy('refresh')
	})

</script>  
</html>		
